---
phase: 08-end-to-end-validation
plan: 01
type: execute
---

<objective>
Generate a complete test wizard project with all step types to validate template fixes.

Purpose: Create real-world test case proving scaffold_wizard generates compilable code.
Output: Test project in /tmp with working wizard using form, select, has_many, and summary steps.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Bug fixes to validate:
@.planning/phases/02-controller-template-fixes/02-02-SUMMARY.md
@.planning/phases/03-service-template-fixes/03-01-SUMMARY.md

# Key insight from CLAUDE.md:
# - Build gomcp to /tmp so it's not tracked

**Test Wizard Requirements:**
- Domain: "order" (represents typical CRUD entity)
- Step types: form (basic fields), select (client selection), has_many (order items), summary (review)
- Route group: authenticated (typical wizard use case)
- Layout: dashboard

**Bugs Being Validated:**
- #a9479784: Controller uses HXRedirect, Component, CSRFToken (should use Redirect, render, middleware.GetCSRFToken)
- #cb94adf6: Service missing repository import (should have wizarddraftrepo import alias)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test project with required domain</name>
  <files>/tmp/wizard-test-project/</files>
  <action>
1. Create test project directory: /tmp/wizard-test-project
2. Use scaffold_project to create project:
   - project_name: "wizardtest"
   - module_path: "github.com/test/wizardtest"
   - database_type: "sqlite"
   - with_auth: true (wizards need authenticated routes)
   - in_current_dir: true
3. Use scaffold_domain to create Client domain (for wizard belongs_to):
   - domain_name: "client"
   - fields: [{name: "Name", type: "string"}, {name: "Email", type: "string"}]
   - route_group: "authenticated"
4. Use scaffold_domain to create Order domain:
   - domain_name: "order"
   - fields: [{name: "Total", type: "float64"}, {name: "Status", type: "string", form_type: "select", options: ["pending", "completed"]}]
   - relationships: [{type: "belongs_to", model: "Client"}]
   - route_group: "authenticated"
5. Use scaffold_domain to create OrderItem domain (for has_many step):
   - domain_name: "orderitem"
   - fields: [{name: "ProductName", type: "string"}, {name: "Quantity", type: "int"}, {name: "Price", type: "float64"}]
   - relationships: [{type: "belongs_to", model: "Order"}]
   - route_group: "authenticated"
  </action>
  <verify>
- ls /tmp/wizard-test-project shows project structure
- go.mod exists with correct module path
- internal/models/ contains Client, Order, OrderItem models
  </verify>
  <done>Test project exists with Client, Order, OrderItem domains scaffolded</done>
</task>

<task type="auto">
  <name>Task 2: Generate wizard with all step types</name>
  <files>/tmp/wizard-test-project/internal/web/order/, /tmp/wizard-test-project/internal/services/wizarddraft/</files>
  <action>
Use scaffold_wizard to create order creation wizard:
- wizard_name: "create_order"
- domain: "order"
- route_group: "authenticated"
- layout: "dashboard"
- steps:
  1. {name: "Select Client", type: "select", fields: ["client_id"], searchable: true}
  2. {name: "Order Details", type: "form", fields: ["status"]}
  3. {name: "Add Items", type: "has_many", child_domain: "orderitem", has_many_mode: "select_existing"}
  4. {name: "Review", type: "summary"}
- success_redirect: "/orders"
- with_drafts: true

This wizard tests all step types:
- select: Client selection with searchable dropdown
- form: Order status field
- has_many: Add order items
- summary: Review before submit
  </action>
  <verify>
- ls /tmp/wizard-test-project/internal/web/order/ shows wizard files
- ls /tmp/wizard-test-project/internal/services/wizarddraft/ shows draft service
- grep -l "wizarddraftrepo" /tmp/wizard-test-project/internal/services/wizarddraft/*.go (validates bug #cb94adf6 fix)
- grep -l "middleware.GetCSRFToken" /tmp/wizard-test-project/internal/web/order/*.go (validates bug #a9479784 fix)
  </verify>
  <done>Wizard generated with all step types, draft service has repository import, controller uses correct methods</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Test project exists at /tmp/wizard-test-project
- [ ] Client, Order, OrderItem domains exist
- [ ] Wizard files generated in internal/web/order/
- [ ] Draft service generated in internal/services/wizarddraft/
- [ ] Draft service imports wizarddraftrepo (bug #cb94adf6 fix)
- [ ] Controller uses middleware.GetCSRFToken not resp.CSRFToken (bug #a9479784 fix)
</verification>

<success_criteria>

- All domains scaffolded successfully
- Wizard with all 4 step types generated
- Generated code exists in expected locations
- Quick check confirms bug fix patterns present
</success_criteria>

<output>
After completion, create `.planning/phases/08-end-to-end-validation/08-01-SUMMARY.md`:

# Phase 8 Plan 1: Generate Test Wizard Project Summary

**[Substantive one-liner about wizard generation outcome]**

## Accomplishments

- Test project created at /tmp/wizard-test-project
- Client, Order, OrderItem domains scaffolded
- Wizard with form/select/has_many/summary steps generated

## Files Created

- /tmp/wizard-test-project/internal/web/order/wizard_create_order.go
- /tmp/wizard-test-project/internal/services/wizarddraft/wizarddraft.go
- /tmp/wizard-test-project/internal/web/order/views/*.templ

## Bug Fix Presence Verified

- #a9479784 patterns: [present/absent]
- #cb94adf6 patterns: [present/absent]

## Issues Encountered

[Any issues or "None"]

## Next Step

Ready for 08-02-PLAN.md (compilation verification)
</output>
