---
phase: 01-analysis
plan: 02
type: execute
---

<objective>
Compare wizard templates against scaffold_domain/controller/service patterns and document all issues requiring fixes.

Purpose: Create a comprehensive issue catalog that guides the fix phases (2-6) with specific, actionable items.
Output: ANALYSIS-FINDINGS.md document cataloging all identified issues with severity, location, and fix approach.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./01-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-analysis/WIZARD-STRUCTURE.md

**Bug reports to verify:**
- Bug #a9479784: Controller uses non-existent web.Response methods
- Bug #cb94adf6: Service missing repository import

**Wizard templates to analyze:**
@internal/templates/wizard/controller.go.tmpl
@internal/templates/wizard/draft_service.go.tmpl
@internal/templates/wizard/draft_repository.go.tmpl

**Reference patterns (correct implementations):**
@internal/templates/domain/controller.go.tmpl
@internal/templates/domain/service.go.tmpl
@internal/templates/domain/repository.go.tmpl
@internal/templates/project/response.go.tmpl
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compare wizard templates to domain equivalents</name>
  <files>.planning/phases/01-analysis/ANALYSIS-FINDINGS.md</files>
  <action>
Systematically compare wizard templates against domain templates to identify all discrepancies:

**Controller Comparison (wizard/controller.go.tmpl vs domain/controller.go.tmpl):**
1. Compare Response method usage:
   - Wizard uses: resp.HXRedirect(), resp.Component(), resp.CSRFToken()
   - Domain uses: res.Redirect(), c.render(), middleware.GetCSRFToken(r.Context())
   - Document each incorrect method call with line numbers

2. Compare import statements:
   - Wizard: missing models import despite using *models.WizardDraft
   - Domain: properly imports all used packages

3. Compare URL path handling:
   - Check for double slash issues in URL construction
   - Document the pattern domain controller uses

**Service Comparison (wizard/draft_service.go.tmpl vs domain/service.go.tmpl):**
1. Compare package imports:
   - Wizard: uses Repository type without importing repository package
   - Domain: properly imports with alias pattern

2. Compare service struct patterns
3. Compare method signatures

**Repository Comparison (wizard/draft_repository.go.tmpl vs domain/repository.go.tmpl):**
1. Compare interface definitions
2. Compare import patterns
3. Check for consistency

Create ANALYSIS-FINDINGS.md with detailed comparison tables.
  </action>
  <verify>grep -c "Issue:" .planning/phases/01-analysis/ANALYSIS-FINDINGS.md returns count of documented issues</verify>
  <done>ANALYSIS-FINDINGS.md contains systematic comparison of wizard vs domain templates with all discrepancies documented</done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive issue catalog with fix recommendations</name>
  <files>.planning/phases/01-analysis/ANALYSIS-FINDINGS.md</files>
  <action>
Append to ANALYSIS-FINDINGS.md a structured issue catalog:

**For each issue, document:**

| Field | Description |
|-------|-------------|
| ID | Unique identifier (e.g., CTRL-001) |
| Bug Reference | If related to #a9479784 or #cb94adf6, note it |
| Severity | Critical (blocks compilation) / High (runtime error) / Medium (incorrect behavior) / Low (inconsistency) |
| Location | File path and line number(s) |
| Current Code | What the template currently generates |
| Expected Code | What it should generate (based on domain patterns) |
| Fix Approach | Specific change required |
| Phase | Which phase should fix this (2-6) |

**Known issues to verify and catalog:**

From Bug #a9479784:
- [ ] resp.HXRedirect() → resp.Redirect()
- [ ] resp.Component() → resp.Render() or c.render()
- [ ] resp.CSRFToken() → middleware.GetCSRFToken(r.Context())
- [ ] Double slashes in URLs
- [ ] Missing models import

From Bug #cb94adf6:
- [ ] Missing repository import in service template

**Additional issues to look for:**
- Inconsistent variable naming (resp vs res)
- Missing error handling patterns
- Layout wrapper inconsistencies
- HTMX pattern differences
- Any other deviations from domain patterns

Organize issues by phase:
- Phase 2: Controller template fixes
- Phase 3: Service template fixes
- Phase 4: View template improvements
- Phase 5: Draft system issues
- Phase 6: Generator logic issues
  </action>
  <verify>grep "Phase 2:" .planning/phases/01-analysis/ANALYSIS-FINDINGS.md shows controller issues cataloged</verify>
  <done>ANALYSIS-FINDINGS.md contains complete issue catalog with all issues categorized by severity, location, and target phase</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ANALYSIS-FINDINGS.md exists with template comparison section
- [ ] All Bug #a9479784 issues verified and documented
- [ ] Bug #cb94adf6 issue verified and documented
- [ ] Any additional issues discovered are cataloged
- [ ] Each issue has severity, location, and fix approach
- [ ] Issues are organized by target fix phase
</verification>

<success_criteria>

- All tasks completed
- Both reported bugs verified with specific template locations
- Complete issue catalog ready to guide Phases 2-6
- Phase 1: Analysis complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-analysis/01-02-SUMMARY.md`:

# Phase 1 Plan 2: Compare and Document Issues Summary

**[One-liner: Total issues found and their distribution across phases]**

## Accomplishments

- Verified Bug #a9479784 issues in controller template
- Verified Bug #cb94adf6 issue in service template
- Identified [N] additional issues
- Created comprehensive fix roadmap

## Files Created/Modified

- `.planning/phases/01-analysis/ANALYSIS-FINDINGS.md` - Issue catalog and comparison analysis

## Decisions Made

[None expected]

## Issues Encountered

[Any unexpected findings]

## Next Step

Phase 1 complete, ready for Phase 2: Controller Template Fixes
</output>
