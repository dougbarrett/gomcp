---
phase: 02-controller-template-fixes
plan: 01
type: execute
subsystem: templates
---

<objective>
Add missing imports and local render method to wizard controller template.

Purpose: Fix CTRL-004, CTRL-005, CTRL-006, CTRL-007 issues - prerequisites for all other controller fixes
Output: Updated controller.go.tmpl with correct imports and render method matching domain controller pattern
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior analysis:
@.planning/phases/01-analysis/01-02-SUMMARY.md
@.planning/phases/01-analysis/ANALYSIS-FINDINGS.md

# Reference templates (correct patterns):
@internal/templates/domain/controller.go.tmpl

# File to fix:
@internal/templates/wizard/controller.go.tmpl

**Tech stack:** Go templates with [[ ]] delimiters, web.Response helper, templ components
**Established patterns:** Domain controller uses local render method, middleware for CSRF, qualified imports
**Constraining decisions:** None - first implementation phase

**Issues being addressed:**
- CTRL-004: Missing middleware import
- CTRL-005: Missing models import (when WithDrafts=true)
- CTRL-006: Missing templ import
- CTRL-007: Missing local render method
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing imports to controller template</name>
  <files>internal/templates/wizard/controller.go.tmpl</files>
  <action>
Add three missing imports to the import block:

1. Middleware import (required for CSRF token access):
   `"[[.ModulePath]]/internal/web/middleware"`

2. Models import (conditional, only when WithDrafts is true):
   `[[if .WithDrafts]]"[[.ModulePath]]/internal/models"[[end]]`

3. Templ import (required for render method signature):
   `"github.com/a-h/templ"`

Follow the domain controller import order:
1. Standard library (net/http, strconv, etc.)
2. Internal packages (services, web, middleware, models)
3. External packages (templ, chi)

Do NOT change any other parts of the template in this task.
  </action>
  <verify>
Run: `grep -n "middleware\|templ\|models" internal/templates/wizard/controller.go.tmpl`
Should show all three imports in the import block
  </verify>
  <done>
- middleware import present in import block
- templ import present in import block
- models import present with [[if .WithDrafts]] conditional
- Import block follows correct ordering
  </done>
</task>

<task type="auto">
  <name>Task 2: Add local render method to controller</name>
  <files>internal/templates/wizard/controller.go.tmpl</files>
  <action>
Add the render method to the controller, matching the domain controller pattern exactly.

Add after the Controller struct definition (after RegisterRoutes), before the first handler:

```go
// render renders a templ component to the response.
func (c *[[.WizardNamePascal]]WizardController) render(w http.ResponseWriter, r *http.Request, component templ.Component) {
	w.Header().Set("Content-Type", "text/html; charset=utf-8")
	component.Render(r.Context(), w)
}
```

This method:
- Sets the correct Content-Type header
- Calls component.Render with request context and response writer
- Matches the domain controller pattern from domain/controller.go.tmpl

Do NOT modify any handler methods yet - that's the next plan.
  </action>
  <verify>
Run: `grep -A4 "func (c \*.*WizardController) render" internal/templates/wizard/controller.go.tmpl`
Should show the render method with correct signature
  </verify>
  <done>
- render method exists on the wizard controller
- Method signature matches: `(w http.ResponseWriter, r *http.Request, component templ.Component)`
- Method sets Content-Type header
- Method calls component.Render(r.Context(), w)
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three imports present in template
- [ ] render method exists with correct signature
- [ ] Template still valid Go template syntax: `go build -o /tmp/gomcp ./cmd/mcp`
</verification>

<success_criteria>
- CTRL-004, CTRL-005, CTRL-006, CTRL-007 resolved
- Template compiles when tested via go build
- Pattern matches domain controller reference
- Ready for Plan 02-02 (method call fixes)
</success_criteria>

<output>
After completion, create `.planning/phases/02-controller-template-fixes/02-01-SUMMARY.md`
</output>
