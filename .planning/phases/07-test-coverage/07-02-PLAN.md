---
phase: 07-test-coverage
plan: 02
type: execute
---

<objective>
Add edge case and integration tests for wizard scaffolding.

Purpose: Existing tests cover happy paths but lack edge case coverage and don't verify generated code compiles. Need to match quality of scaffold_domain edge case tests.
Output: Edge case tests and integration test that verifies generated wizard code compiles.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/07-test-coverage/07-01-SUMMARY.md

# Reference patterns:
@internal/tools/edge_cases_test.go
@internal/tools/integration_test.go
@internal/tools/scaffold_wizard_test.go

**Tech stack available:** Go standard testing, table-driven tests, temp directories, gofmt validation
**Established patterns:**
- Edge cases in edge_cases_test.go
- Integration tests use exec.LookPath("go") check and testing.Short() skip
- Use gofmt to validate generated Go files
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wizard edge case tests</name>
  <files>internal/tools/edge_cases_test.go</files>
  <action>
Add TestWizardEdgeCases function covering:
1. Wizard with all step types in one wizard (form, select, has_many, summary)
2. Wizard with maximum step count (10+ steps)
3. Wizard with special characters in wizard name (should fail or sanitize)
4. Wizard with reserved Go keywords as domain name
5. Wizard on non-existent domain (should still work - domain is just for organization)
6. Multiple wizards with same name on different domains
7. Wizard with empty step name (should fail validation)
8. Wizard with create_inline has_many mode

Follow existing edge_cases_test.go patterns:
- Table-driven tests where applicable
- Use testRegistry(t) and setupGoMod(t, tmpDir, modulePath)
- Test both success and failure scenarios
  </action>
  <verify>go test -v -run TestWizardEdgeCases ./internal/tools/... passes</verify>
  <done>TestWizardEdgeCases added with 8+ edge case scenarios, all tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Add wizard integration test</name>
  <files>internal/tools/integration_test.go</files>
  <action>
Add TestWizardIntegration function that:
1. Scaffolds a complete project with auth
2. Scaffolds a domain (order with client relationship)
3. Scaffolds a wizard with multiple step types:
   - select step (Select Client)
   - form step (Order Details)
   - has_many step (Add Items)
   - summary step (Review)
4. Runs gofmt on all generated .go files to verify syntax
5. Optionally runs `go build` to verify imports and types resolve

Follow existing TestDomainIntegration pattern:
- Skip if testing.Short()
- Skip if go command not available (exec.LookPath)
- Use filepath.Walk to find all .go files
- Run gofmt -e to check syntax

This is a "smoke test" that ensures the wizard generator produces valid Go code.
  </action>
  <verify>go test -v -run TestWizardIntegration ./internal/tools/... passes</verify>
  <done>TestWizardIntegration exists and verifies generated wizard code has valid syntax</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go test -v -run TestWizardEdgeCases ./internal/tools/...` passes
- [ ] `go test -v -run TestWizardIntegration ./internal/tools/...` passes
- [ ] `go test ./...` passes (no regressions)
</verification>

<success_criteria>

- TestWizardEdgeCases added with 8+ scenarios
- TestWizardIntegration added with full wizard generation and syntax validation
- All tests pass
- No regressions in other tests
</success_criteria>

<output>
After completion, create `.planning/phases/07-test-coverage/07-02-SUMMARY.md`
</output>
