---
phase: 07-test-coverage
plan: 03
type: execute
---

<objective>
Add template validation tests for wizard templates following existing template_validation_test.go patterns.

Purpose: Other scaffold types (domain, project, views, seeds, configs) have template validation tests. Wizard templates need the same coverage to catch syntax errors early.
Output: Wizard template validation tests that verify generated Go and templ files are syntactically valid.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/07-test-coverage/07-01-SUMMARY.md
@.planning/phases/07-test-coverage/07-02-SUMMARY.md

# Reference patterns:
@internal/tools/template_validation_test.go

# Wizard templates to validate:
@internal/templates/wizard/controller.go.tmpl
@internal/templates/wizard/draft_model.go.tmpl
@internal/templates/wizard/draft_repository.go.tmpl
@internal/templates/wizard/draft_service.go.tmpl
@internal/templates/wizard/wizard.templ.tmpl
@internal/templates/wizard/step_form.templ.tmpl
@internal/templates/wizard/step_select.templ.tmpl
@internal/templates/wizard/step_has_many.templ.tmpl
@internal/templates/wizard/step_summary.templ.tmpl

**Tech stack available:** Go standard testing, gofmt for Go syntax, string checks for templ
**Established patterns:**
- Skip if testing.Short()
- Skip if go command not available
- Use gofmt -e to validate Go syntax
- Check templ files have package declaration and templ function
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wizard Go template validation test</name>
  <files>internal/tools/template_validation_test.go</files>
  <action>
Add TestTemplateValidation_WizardTemplates function that:
1. Scaffolds a project
2. Scaffolds a wizard with form, select, has_many, and summary steps
3. Validates all generated .go files with gofmt:
   - internal/web/{domain}/wizard_{name}.go (controller)
   - internal/models/wizard_draft.go (draft model)
   - internal/repository/wizarddraft/wizarddraft.go (draft repository)
   - internal/services/wizarddraft/wizarddraft.go (draft service)

Follow TestTemplateValidation_DomainTemplates pattern exactly:
- Skip if testing.Short() or go command not available
- Use filepath.Walk or explicit file list
- Run gofmt -e on each .go file
- Report syntax errors with file path and gofmt output
  </action>
  <verify>go test -v -run TestTemplateValidation_WizardTemplates ./internal/tools/... passes</verify>
  <done>TestTemplateValidation_WizardTemplates exists and validates all wizard Go files</done>
</task>

<task type="auto">
  <name>Task 2: Add wizard templ file validation test</name>
  <files>internal/tools/template_validation_test.go</files>
  <action>
Extend TestTemplateValidation_WizardTemplates (or add TestTemplateValidation_WizardViews) to:
1. Check wizard templ files exist:
   - internal/web/{domain}/views/wizard_{name}.templ (main wizard view)
   - internal/web/{domain}/views/wizard_{name}_step1.templ (form step)
   - internal/web/{domain}/views/wizard_{name}_step2.templ (select step)
   - internal/web/{domain}/views/wizard_{name}_step3.templ (has_many step)
   - internal/web/{domain}/views/wizard_{name}_step4.templ (summary step)

2. Validate templ files have basic structure:
   - Contains "package views"
   - Contains "templ " function declaration
   - No obvious template expansion errors (check for [[ ]] left unexpanded)

Follow TestTemplateValidation_ViewTemplates pattern:
- Use fileExists check
- Read content and verify package/templ declarations
- Report errors with file path and content excerpt
  </action>
  <verify>go test -v -run TestTemplateValidation_Wizard ./internal/tools/... passes</verify>
  <done>Wizard templ file validation exists and verifies all step view files</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go test -v -run TestTemplateValidation_Wizard ./internal/tools/...` passes
- [ ] `go test ./...` passes (no regressions)
- [ ] All wizard template types covered (controller, draft model, draft repo, draft service, views)
</verification>

<success_criteria>

- TestTemplateValidation_WizardTemplates added for Go files
- Wizard templ validation added for view files
- All tests pass
- No regressions in other tests
- Phase 7 complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-test-coverage/07-03-SUMMARY.md`
</output>
