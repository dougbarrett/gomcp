---
phase: 07-test-coverage
plan: 01
type: execute
---

<objective>
Add test coverage for wizard DI wiring and metadata tracking functions.

Purpose: The `injectWizardWiring` function added in Phase 06-02 has 0% coverage, and metadata tracking for wizards is untested. These are critical path features that need verification.
Output: Tests covering DI wiring injection and wizard metadata tracking.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase providing DI wiring implementation:
@.planning/phases/06-generator-logic-review/06-02-SUMMARY.md

# Key files:
@internal/tools/scaffold_wizard.go
@internal/tools/scaffold_wizard_test.go
@internal/metadata/metadata.go
@internal/metadata/metadata_test.go

**Tech stack available:** Go standard testing, table-driven tests, temp directories
**Established patterns:** testRegistry helper, setupGoMod helper, fileExists helper
**Constraining decisions:**
- (06-02): Wizard metadata uses composite key (domain:wizardName) for uniqueness
- (06-02): Draft system wiring is conditional on WithDrafts=true
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tests for injectWizardWiring function</name>
  <files>internal/tools/scaffold_wizard_test.go</files>
  <action>
Add a new test function TestInjectWizardWiring that verifies:
1. Wiring is injected into main.go when wizard is generated (check for import, repo instantiation, controller registration)
2. Draft system wiring is added when WithDrafts=true
3. Draft system wiring is NOT added when WithDrafts=false
4. Multiple wizards on same domain don't duplicate base domain wiring

Follow the existing test pattern:
- Use testRegistry(t) for temp directory setup
- Use setupGoMod(t, tmpDir, modulePath)
- Scaffold a project first, then scaffold wizard, then check main.go content
- Use table-driven tests for multiple scenarios

Key assertions:
- main.go contains wizard controller import
- main.go contains wizard controller instantiation
- main.go contains wizard route registration
- When WithDrafts=true: main.go contains draft repo/service imports and instantiation
  </action>
  <verify>go test -v -run TestInjectWizardWiring ./internal/tools/... passes</verify>
  <done>TestInjectWizardWiring exists and passes, covering DI wiring scenarios</done>
</task>

<task type="auto">
  <name>Task 2: Add tests for wizard metadata tracking</name>
  <files>internal/metadata/metadata_test.go</files>
  <action>
Add test cases to verify wizard metadata tracking:
1. Test that scaffolding a wizard creates a metadata entry with composite key "domain:wizardName"
2. Test that metadata includes wizard-specific fields (steps, form_style, layout, route_group)
3. Test that multiple wizards for same domain create separate entries

Check existing metadata_test.go patterns and extend them. If no metadata_test.go exists, create one following existing test patterns.

Use the metadata package's public API:
- metadata.SaveScaffoldMetadata(...)
- metadata.LoadScaffoldMetadata(...)
  </action>
  <verify>go test -v -run TestWizard ./internal/metadata/... passes (or relevant test name)</verify>
  <done>Wizard metadata tests exist and pass, verifying composite key and wizard-specific fields</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go test -v -run TestInjectWizardWiring ./internal/tools/...` passes
- [ ] `go test -v ./internal/metadata/...` passes
- [ ] `go test ./...` passes (no regressions)
- [ ] Coverage of injectWizardWiring improved from 0%
</verification>

<success_criteria>

- TestInjectWizardWiring added with DI wiring verification
- Wizard metadata tests added
- All tests pass
- No regressions in other tests
</success_criteria>

<output>
After completion, create `.planning/phases/07-test-coverage/07-01-SUMMARY.md`
</output>
