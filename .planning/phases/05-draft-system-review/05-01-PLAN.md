---
phase: 05-draft-system-review
plan: 01
type: execute
---

<objective>
Review draft model and repository templates for correctness and database compatibility.

Purpose: Ensure draft persistence layer follows scaffold patterns and works across all supported databases.
Output: Verified draft_model.go.tmpl, fixed draft_repository.go.tmpl with database-agnostic DeleteExpired.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference patterns:
@internal/templates/domain/repository.go.tmpl

# Files to review/modify:
@internal/templates/wizard/draft_model.go.tmpl
@internal/templates/wizard/draft_repository.go.tmpl

**Prior Phase Context:**
- Phase 4 completed view template improvements
- No issues deferred from prior phases affecting this work

**Issue Being Fixed:**
- draft_repository.go.tmpl uses MySQL-specific `INTERVAL ? DAY` syntax in DeleteExpired
- This breaks SQLite and PostgreSQL compatibility
</context>

<tasks>

<task type="auto">
  <name>Task 1: Review draft model template</name>
  <files>internal/templates/wizard/draft_model.go.tmpl</files>
  <action>Review draft_model.go.tmpl for:
  - Required fields present (ID, WizardName, Domain, UserID, StepData, CurrentStep)
  - Proper GORM tags (primaryKey, indexes, text type for JSON)
  - Soft delete support via DeletedAt
  - TableName method for explicit table naming

  Document any issues found. Model appears complete based on initial review - confirm and note for summary.</action>
  <verify>Read the file and confirm all required elements are present</verify>
  <done>Draft model template verified as complete with all required fields and GORM configuration</done>
</task>

<task type="auto">
  <name>Task 2: Fix database-agnostic DeleteExpired</name>
  <files>internal/templates/wizard/draft_repository.go.tmpl</files>
  <action>Replace MySQL-specific INTERVAL syntax with Go time calculation:

Current (MySQL-only):
```go
Where("created_at < NOW() - INTERVAL ? DAY", olderThanDays)
```

Fixed (database-agnostic):
```go
cutoff := time.Now().AddDate(0, 0, -olderThanDays)
...Where("created_at < ?", cutoff)
```

This requires adding "time" to the imports. The Go time calculation works with SQLite, PostgreSQL, and MySQL.</action>
  <verify>grep for "INTERVAL" should return empty; grep for "time.Now().AddDate" should find the fix</verify>
  <done>DeleteExpired uses Go time.Now().AddDate() instead of MySQL INTERVAL syntax, time package imported</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] draft_model.go.tmpl reviewed and documented
- [ ] draft_repository.go.tmpl no longer contains MySQL-specific INTERVAL syntax
- [ ] "time" package is imported in draft_repository.go.tmpl
- [ ] DeleteExpired uses time.Now().AddDate() for cutoff calculation
</verification>

<success_criteria>
- Draft model template verified as complete
- Draft repository template uses database-agnostic date calculation
- No MySQL-specific syntax remains in DeleteExpired method
</success_criteria>

<output>
After completion, create `.planning/phases/05-draft-system-review/05-01-SUMMARY.md`
</output>
