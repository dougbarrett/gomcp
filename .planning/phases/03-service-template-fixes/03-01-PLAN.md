---
phase: 03-service-template-fixes
plan: 01
type: execute
---

<objective>
Fix wizard draft service template to compile correctly by adding missing repository import and aligning with domain service patterns.

Purpose: Resolve Bug #cb94adf6 - wizard service fails to compile due to undefined Repository type.
Output: Working draft_service.go.tmpl that follows same patterns as domain/service.go.tmpl.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (Phase 2 completed controller template fixes):
@.planning/phases/02-controller-template-fixes/02-02-SUMMARY.md

# Analysis findings with exact issues:
@.planning/phases/01-analysis/ANALYSIS-FINDINGS.md

# Source files to modify:
@internal/templates/wizard/draft_service.go.tmpl

# Reference pattern (domain service):
@internal/templates/domain/service.go.tmpl

**Tech stack available:** Go templates with [[ ]] delimiters
**Established patterns:**
- Repository imports use `{pkg}repo` alias: `[[.PackageName]]repo "[[.ModulePath]]/internal/repository/[[.PackageName]]"`
- Repository types fully qualified: `[[.PackageName]]repo.Repository`
- Services define domain-specific error variables
- MCP injection markers enable extensibility

**Issues being addressed:**
- SVC-001: Missing repository import (Critical)
- SVC-002: Unqualified Repository type (Critical)

**Bug resolution:** Bug #cb94adf6 will be resolved by this plan.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix repository import and type qualification</name>
  <files>internal/templates/wizard/draft_service.go.tmpl</files>
  <action>
Fix the two critical compilation issues:

1. Add repository import with alias to import block (after models import):
   `wizarddraftrepo "[[.ModulePath]]/internal/repository/wizarddraft"`

2. Qualify Repository type in struct field (line 22):
   Change: `repo Repository`
   To: `repo wizarddraftrepo.Repository`

3. Qualify Repository type in NewService parameter (line 26):
   Change: `func NewService(repo Repository) Service`
   To: `func NewService(repo wizarddraftrepo.Repository) Service`

This follows the exact pattern from domain/service.go.tmpl.
  </action>
  <verify>Build gomcp to /tmp: `go build -o /tmp/gomcp ./cmd/gomcp` - should succeed without "undefined: Repository" errors</verify>
  <done>draft_service.go.tmpl has wizarddraftrepo import and qualified Repository types</done>
</task>

<task type="auto">
  <name>Task 2: Add service pattern enhancements</name>
  <files>internal/templates/wizard/draft_service.go.tmpl</files>
  <action>
Align with domain service patterns by adding:

1. Add errors import to import block:
   `"errors"`

2. Add error variable after imports (before Service interface):
   ```go
   var (
       // ErrWizardDraftNotFound is returned when a wizard draft is not found.
       ErrWizardDraftNotFound = errors.New("wizard draft not found")
   )
   ```

3. Add MCP injection markers to Service interface (before closing brace):
   ```go
   // MCP:SERVICE_INTERFACE:START
   // MCP:SERVICE_INTERFACE:END
   ```

4. Add MCP injection markers at end of file:
   ```go
   // MCP:SERVICE_METHODS:START
   // MCP:SERVICE_METHODS:END
   ```

These enhancements enable future extensibility via extend_service tool.
  </action>
  <verify>Build gomcp to /tmp: `go build -o /tmp/gomcp ./cmd/gomcp` - should succeed</verify>
  <done>draft_service.go.tmpl has error variable and MCP markers matching domain service pattern</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `go build -o /tmp/gomcp ./cmd/gomcp` succeeds
- [ ] `go test ./...` passes
- [ ] draft_service.go.tmpl has wizarddraftrepo import
- [ ] draft_service.go.tmpl has qualified Repository types
- [ ] draft_service.go.tmpl has ErrWizardDraftNotFound error
- [ ] draft_service.go.tmpl has MCP injection markers
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No compilation errors
- Bug #cb94adf6 issues (SVC-001, SVC-002) resolved
- Service template aligned with domain service patterns
</success_criteria>

<output>
After completion, create `.planning/phases/03-service-template-fixes/03-01-SUMMARY.md`:

# Phase 3 Plan 1: Service Template Fixes Summary

**[Substantive one-liner - what shipped]**

## Performance

- **Duration:** X min
- **Tasks:** 2
- **Files modified:** 1

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Task Commits

1. **Task 1: Fix repository import** - `{hash}` (fix)
2. **Task 2: Add pattern enhancements** - `{hash}` (feat)

## Files Created/Modified

- `internal/templates/wizard/draft_service.go.tmpl` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Deviations from Plan

[Any deviations, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Bug #cb94adf6 Resolution

| Issue | Description | Resolution | Commit |
|-------|-------------|------------|--------|
| SVC-001 | Missing repository import | Added wizarddraftrepo import | {hash} |
| SVC-002 | Unqualified Repository type | Qualified with wizarddraftrepo | {hash} |

## Next Phase Readiness

- Phase 3 complete
- Bug #cb94adf6 can be closed after end-to-end validation (Phase 8)
- Ready for Phase 4: View Template Improvements
</output>
