---
phase: 09-wizard-bug-fixes
plan: 02
type: execute
---

<objective>
Fix scaffold_wizard to auto-generate wizard components that views depend on.

Purpose: Eliminate undefined component errors when generating wizard code.
Output: scaffold_wizard automatically generates wizard components (WizardNav, WizardEmpty, etc.) if they don't exist.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-wizard-bug-fixes/09-01-SUMMARY.md

**Bug to fix:**
- **b88f8cab**: scaffold_wizard doesn't auto-generate wizard components

**Key files:**
@internal/tools/scaffold_wizard.go
@internal/templates/components/wizard.templ.tmpl
@internal/templates/wizard/step_form.templ.tmpl (uses @components.WizardNav, etc.)
@internal/templates/wizard/step_has_many.templ.tmpl (uses @components.WizardEmpty, etc.)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wizard component generation to scaffold_wizard</name>
  <files>internal/tools/scaffold_wizard.go</files>
  <action>
  The wizard view templates use components like @components.WizardNav, @components.WizardEmpty, @components.WizardProgress, etc. but scaffold_wizard doesn't generate these components.

  Modify scaffoldWizard() function to:
  1. Add "internal/web/components" to the directories to create
  2. Generate the wizard components using gen.GenerateFileIfNotExists() to avoid overwriting if they exist
  3. Use the existing template at "components/wizard.templ.tmpl"

  Add after the existing directory creation (around line 170):
  ```go
  // Ensure components directory exists
  if err := gen.EnsureDir(filepath.Join("internal", "web", "components")); err != nil {
      return types.NewErrorResult(fmt.Sprintf("failed to create components directory: %v", err)), nil
  }

  // Generate wizard components if they don't exist
  wizardComponentsPath := filepath.Join("internal", "web", "components", "wizard.templ")
  if err := gen.GenerateFileIfNotExists("components/wizard.templ.tmpl", wizardComponentsPath, data); err != nil {
      return types.NewErrorResult(fmt.Sprintf("failed to generate wizard components: %v", err)), nil
  }
  ```

  Use GenerateFileIfNotExists to preserve any existing customizations. The template doesn't need any specific data since it uses static content.
  </action>
  <verify>grep -A5 "wizard components" internal/tools/scaffold_wizard.go shows the new code</verify>
  <done>scaffold_wizard generates wizard.templ to internal/web/components/ if it doesn't exist</done>
</task>

<task type="auto">
  <name>Task 2: Update next steps and suggested tools</name>
  <files>internal/tools/scaffold_wizard.go</files>
  <action>
  Update the nextSteps and suggestedTools to reflect that wizard components are now auto-generated:

  1. Remove the scaffold_component suggestion since it's now automatic
  2. Update nextSteps to mention "templ generate" will process the new wizard.templ

  The suggestedTools section around line 258 should be simplified since the critical scaffold_component wizard call is now automatic.
  </action>
  <verify>grep -A10 "suggestedTools" internal/tools/scaffold_wizard.go shows updated suggestions without scaffold_component wizard</verify>
  <done>Next steps and suggested tools updated to reflect auto-generation of wizard components</done>
</task>

<task type="auto">
  <name>Task 3: Add test for wizard component generation</name>
  <files>internal/tools/scaffold_wizard_test.go</files>
  <action>
  Add a test case to verify scaffold_wizard generates wizard components:

  Create or update TestScaffoldWizard to verify:
  1. After scaffolding a wizard, internal/web/components/wizard.templ exists
  2. The file contains expected component definitions (WizardNav, WizardEmpty, etc.)
  3. If wizard.templ already exists, it's not overwritten (GenerateFileIfNotExists behavior)

  Pattern the test after existing scaffold tests in the codebase.
  </action>
  <verify>go test ./internal/tools/... -run TestScaffoldWizard -v passes</verify>
  <done>Test verifies wizard components are auto-generated during wizard scaffolding</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build -o /tmp/gomcp ./cmd/gomcp` succeeds
- [ ] `go test ./internal/tools/...` passes all tests
- [ ] Manually test: scaffold a wizard and verify internal/web/components/wizard.templ is created
</verification>

<success_criteria>

- scaffold_wizard auto-generates wizard components
- Components only generated if they don't exist (preserves customizations)
- Tests verify the behavior
</success_criteria>

<output>
After completion, create `.planning/phases/09-wizard-bug-fixes/09-02-SUMMARY.md`
</output>
