---
phase: 09-wizard-bug-fixes
plan: 01
type: execute
---

<objective>
Fix wizard controller template bugs: unused 'resp' variable and wrong DTO type name.

Purpose: Eliminate compilation errors in generated wizard controller code.
Output: Fixed controller.go.tmpl that generates code without unused variables or wrong type references.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-end-to-end-validation/08-01-SUMMARY.md

**Bugs to fix:**
- **5ab684ea**: Wizard controller has unused 'resp' variable in Step handlers
- **ab2c40cb**: Wizard controller references wrong DTO type name (CreateOrderDTO vs CreateOrderInput)

**Key files:**
@internal/templates/wizard/controller.go.tmpl
@internal/templates/domain/dto.go.tmpl (reference for correct DTO naming)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused 'resp' variable from Step handlers</name>
  <files>internal/templates/wizard/controller.go.tmpl</files>
  <action>
  In the Step handler template (around line 109), the function declares `resp := web.NewResponse(w, r)` but never uses it - the function only calls `c.render()` which doesn't use resp.

  Remove the unused `resp := web.NewResponse(w, r)` declaration from the Step handler function.

  The Step handler should only declare resp if it's actually used (e.g., for error handling or redirects). Since this handler just renders a view via c.render(), no resp is needed.

  Note: The StepSubmit handler DOES use resp (for redirects and errors), so leave that one unchanged.
  </action>
  <verify>grep -n "resp := web.NewResponse" internal/templates/wizard/controller.go.tmpl - verify resp is only declared where used</verify>
  <done>Step handler no longer declares unused resp variable; StepSubmit handlers still have it where needed</done>
</task>

<task type="auto">
  <name>Task 2: Fix DTO type name from DTO to Input</name>
  <files>internal/templates/wizard/controller.go.tmpl</files>
  <action>
  In the Submit handler (around lines 233 and 248), the template uses:
  `dto := [[.PackageName]].Create[[.ModelName]]DTO{`

  But scaffold_domain generates `Create[[.ModelName]]Input` (see dto.go.tmpl line 5).

  Change both occurrences of `Create[[.ModelName]]DTO` to `Create[[.ModelName]]Input`.

  There are two places to fix:
  1. Inside the WithDrafts conditional (around line 233)
  2. In the else branch (around line 248)
  </action>
  <verify>grep "Create.*DTO" internal/templates/wizard/controller.go.tmpl should return empty; grep "Create.*Input" internal/templates/wizard/controller.go.tmpl should show the fixed references</verify>
  <done>Both occurrences of Create...DTO changed to Create...Input, matching scaffold_domain patterns</done>
</task>

<task type="auto">
  <name>Task 3: Update existing tests to verify fixes</name>
  <files>internal/templates/templates_test.go</files>
  <action>
  Add or update test cases to verify:
  1. Wizard controller Step handler doesn't have unused resp variable
  2. Wizard controller Submit handler uses Create...Input (not Create...DTO)

  Add a test function like TestWizardControllerTemplatePatterns that:
  - Generates the wizard controller template with test data
  - Verifies no "resp := web.NewResponse" in Step handler context (or if present, is actually used)
  - Verifies "Create.*Input" is used instead of "Create.*DTO"

  Use existing test patterns from the file as reference.
  </action>
  <verify>go test ./internal/templates/... -run TestWizardController -v passes</verify>
  <done>Test verifies wizard controller uses correct DTO naming and has no unused variables</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build /tmp/gomcp ./cmd/gomcp` succeeds
- [ ] `go test ./internal/templates/...` passes all tests
- [ ] grep confirms no "Create.*DTO" in wizard controller template
- [ ] No unused variable warnings in generated code
</verification>

<success_criteria>

- Both controller template bugs fixed
- Tests verify the fixes
- Generated wizard code compiles without unused variable warnings
</success_criteria>

<output>
After completion, create `.planning/phases/09-wizard-bug-fixes/09-01-SUMMARY.md`
</output>
