---
phase: 06-generator-logic-review
plan: 02
type: execute
---

<objective>
Fix generator logic issues identified in Plan 01 review.

Purpose: Bring scaffold_wizard.go up to the same quality standard as scaffold_domain.go.
Output: Updated scaffold_wizard.go with DI wiring and metadata tracking.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-generator-logic-review/GENERATOR-REVIEW.md
@.planning/phases/06-generator-logic-review/06-01-SUMMARY.md

# Key source files:
@internal/tools/scaffold_wizard.go
@internal/tools/scaffold_domain.go
@internal/modifier/inject.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add DI wiring injection for wizard</name>
  <files>internal/tools/scaffold_wizard.go</files>
  <action>
Add automatic DI wiring to scaffold_wizard.go following scaffold_domain.go patterns:

1. **Add imports** at top of file:
   ```go
   "github.com/dbb1dev/go-mcp/internal/metadata"
   "github.com/dbb1dev/go-mcp/internal/modifier"
   ```

2. **Add version constant** after imports:
   ```go
   // Note: Uses ScaffolderVersion from scaffold_domain.go
   ```

3. **Add DI wiring function** (similar to injectDomainWiring):
   Create `injectWizardWiring` function that:
   - Injects wizard controller import into main.go
   - Registers wizard routes (under domain's route group)
   - If WithDrafts: Injects draft repo/service imports
   - If WithDrafts: Instantiates draft repo and service
   - If WithDrafts: Injects WizardDraft into database.go AutoMigrate

4. **Call wiring function** after generation (before result):
   - Only if not dry run
   - Handle errors gracefully (warning, not failure)
   - Track updated files in result.FilesUpdated

Key considerations:
- Wizard routes should be registered under the domain's existing route group
- Draft system wiring is conditional on WithDrafts=true
- Use modifier.Injector for code injection
- Follow same error handling pattern as scaffold_domain.go (warn but don't fail)
  </action>
  <verify>go build /tmp/gomcp && echo "Build successful"</verify>
  <done>DI wiring injection added, scaffold_wizard.go compiles without errors</done>
</task>

<task type="auto">
  <name>Task 2: Add metadata tracking for wizard scaffolds</name>
  <files>internal/tools/scaffold_wizard.go</files>
  <action>
Add metadata tracking to scaffold_wizard.go following scaffold_domain.go pattern:

1. **After successful generation** (not dry run), save wizard metadata:
   ```go
   // Save scaffold metadata for future sync/upgrade capabilities
   metaStore := metadata.NewStore(registry.WorkingDir)
   if err := metaStore.SaveWizard(input.WizardName, input.Domain, input, ScaffolderVersion); err != nil {
       // Log warning but don't fail - metadata is optional
       fmt.Printf("Warning: could not save scaffold metadata: %v\n", err)
   } else {
       result.FilesUpdated = append(result.FilesUpdated, ".mcp/scaffold-metadata.json")
   }
   ```

2. **Check if SaveWizard method exists** in metadata package:
   - If not, add it following SaveDomain pattern
   - Wizard metadata should track: wizard_name, domain, steps, layout, route_group, etc.

3. **Update result.FilesUpdated** to include metadata file when saved

Note: If metadata.SaveWizard doesn't exist, create it in internal/metadata/metadata.go following the SaveDomain pattern.
  </action>
  <verify>go build /tmp/gomcp && echo "Build successful"</verify>
  <done>Metadata tracking added, builds successfully, metadata saved on scaffold</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build -o /tmp/gomcp ./cmd/gomcp` succeeds without errors
- [ ] DI wiring code added to scaffold_wizard.go
- [ ] Metadata tracking code added to scaffold_wizard.go
- [ ] All changes follow scaffold_domain.go patterns
- [ ] Changes committed to git
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- scaffold_wizard.go has feature parity with scaffold_domain.go for DI wiring and metadata
- Code compiles without errors
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-generator-logic-review/06-02-SUMMARY.md`:

# Phase 6 Plan 2: Fix Generator Logic Issues Summary

**[One-liner describing fixes applied]**

## Accomplishments

- [Key fixes]

## Files Created/Modified

- `internal/tools/scaffold_wizard.go` - Added DI wiring and metadata tracking
- [Any other files modified]

## Decisions Made

[Implementation decisions]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 6 complete, ready for Phase 7: Test Coverage
</output>
