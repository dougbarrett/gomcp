package views

import (
	"fmt"

	"[[.ModulePath]]/internal/models"
	"[[.ModulePath]]/internal/web/components"
)

// [[.ModelName]]ShowProps contains props for the [[.ModelName]] show view.
type [[.ModelName]]ShowProps struct {
	Item     *models.[[.ModelName]]
	BasePath string // URL base path (e.g., "/admin/[[.URLPathSegment]]" or "[[.URLPath]]")
}

// getBasePath returns the base path, defaulting to "[[.URLPath]]" if not set.
func (p [[.ModelName]]ShowProps) getBasePath() string {
	if p.BasePath != "" {
		return p.BasePath
	}
	return "[[.URLPath]]"
}

// [[.ModelName]]Show renders the detail view for a [[.ModelName]].
templ [[.ModelName]]Show(props [[.ModelName]]ShowProps) {
	<div class="space-y-6">
		<!-- Header -->
		<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
			<div class="flex items-center gap-4">
				@components.Button(components.ButtonProps{
					Variant: "ghost",
					Size:    "sm",
					Attributes: templ.Attributes{
						"hx-get":      props.getBasePath(),
						"hx-target":   "#main-content",
						"hx-push-url": "true",
					},
				}) {
					@components.Icon("arrow-left", "h-4 w-4 mr-2")
					Back to [[pluralize .ModelName]]
				}
			</div>
			<div class="flex items-center gap-3">
				@components.Button(components.ButtonProps{
					Variant: "outline",
					Attributes: templ.Attributes{
						"hx-get":    fmt.Sprintf("%s/%d/edit", props.getBasePath(), props.Item.ID),
						"hx-target": "#modal-container",
						"hx-swap":   "innerHTML",
					},
				}) {
					@components.Icon("pencil", "h-4 w-4 mr-2")
					Edit
				}
				@components.Button(components.ButtonProps{
					Variant: "destructive",
					Attributes: templ.Attributes{
						"hx-delete":  fmt.Sprintf("%s/%d", props.getBasePath(), props.Item.ID),
						"hx-confirm": "Are you sure you want to delete this [[.ModelName | toLower]]?",
						"hx-target":  "#main-content",
						"hx-swap":    "innerHTML",
					},
				}) {
					@components.Icon("trash", "h-4 w-4 mr-2")
					Delete
				}
			</div>
		</div>

		<!-- Detail Card -->
		@components.Card(components.CardProps{}) {
			@components.CardHeader("") {
				<div class="flex items-center justify-between">
					<div>
						<h1 class="text-2xl font-bold text-gray-900 dark:text-white">
							[[- range $i, $f := .Fields]]
							[[- if eq $i 0]]
							{ [[if eq $f.Type "string"]]props.Item.[[.Name]][[else]]fmt.Sprintf("%v", props.Item.[[.Name]])[[end]] }
							[[- end]]
							[[- end]]
						</h1>
						<p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
							ID: { fmt.Sprintf("%d", props.Item.ID) }
						</p>
					</div>
					[[- if .WithSoftDelete]]
					if props.Item.DeletedAt.Valid {
						@components.Badge(components.BadgeProps{Variant: "destructive"}) {
							Deleted
						}
					}
					[[- end]]
				</div>
			}
			@components.CardContent("") {
				<dl class="grid grid-cols-1 sm:grid-cols-2 gap-6">
					[[- range .Fields]]
					<div>
						<dt class="text-sm font-medium text-gray-500 dark:text-gray-400">[[.Label]]</dt>
						<dd class="mt-1 text-gray-900 dark:text-white">
							[[- if eq .Type "bool"]]
							if props.Item.[[.Name]] {
								@components.Badge(components.BadgeProps{Variant: "success"}) {
									Yes
								}
							} else {
								@components.Badge(components.BadgeProps{Variant: "secondary"}) {
									No
								}
							}
							[[- else if eq .Type "time.Time"]]
							{ props.Item.[[.Name]].Format("January 02, 2006 at 3:04 PM") }
							[[- else if eq .Type "*time.Time"]]
							if props.Item.[[.Name]] != nil {
								{ props.Item.[[.Name]].Format("January 02, 2006 at 3:04 PM") }
							} else {
								<span class="text-gray-400">Not set</span>
							}
							[[- else if eq .Type "string"]]
							if props.Item.[[.Name]] != "" {
								{ props.Item.[[.Name]] }
							} else {
								<span class="text-gray-400">-</span>
							}
							[[- else]]
							{ fmt.Sprintf("%v", props.Item.[[.Name]]) }
							[[- end]]
						</dd>
					</div>
					[[- end]]
					<div>
						<dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Created</dt>
						<dd class="mt-1 text-gray-900 dark:text-white">
							{ props.Item.CreatedAt.Format("January 02, 2006 at 3:04 PM") }
						</dd>
					</div>
					<div>
						<dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Last Updated</dt>
						<dd class="mt-1 text-gray-900 dark:text-white">
							{ props.Item.UpdatedAt.Format("January 02, 2006 at 3:04 PM") }
						</dd>
					</div>
				</dl>
			}
		}
	</div>

	<!-- Modal Container -->
	@components.ModalContainer()
}

// [[.ModelName]]ShowPartial renders just the content for HTMX updates.
templ [[.ModelName]]ShowPartial(props [[.ModelName]]ShowProps) {
	@[[.ModelName]]Show(props)
}
