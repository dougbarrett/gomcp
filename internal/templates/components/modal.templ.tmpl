package components

// Note: This component is in the same package as common.templ, so it can
// use Icon, Button, ModalBackdrop, ModalDialog directly without import.

// [[.ModalName]]Props contains properties for the [[.ModalName]] modal.
type [[.ModalName]]Props struct {
	Title       string
	Description string
	Size        string // sm, md, lg, xl, full
	[[- if .IsConfirm]]
	ConfirmText string
	CancelText  string
	OnConfirm   string // HTMX action URL
	[[- end]]
}

[[- if .IsDialog]]
// [[.ModalName]] renders a dialog modal.
templ [[.ModalName]](props [[.ModalName]]Props) {
	@ModalBackdrop() {
		@ModalDialog(props.Size) {
			<!-- Header -->
			<div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
				<div>
					<h2 class="text-lg font-semibold text-gray-900 dark:text-white">
						{ props.Title }
					</h2>
					if props.Description != "" {
						<p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
							{ props.Description }
						</p>
					}
				</div>
				<button
					type="button"
					class="text-gray-400 hover:text-gray-500 focus:outline-none"
					_="on click remove closest .fixed"
				>
					@Icon("x", "h-5 w-5")
				</button>
			</div>
			<!-- Content -->
			<div class="p-4">
				{ children... }
			</div>
		}
	}
}
[[- end]]

[[- if .IsSheet]]
// [[.ModalName]] renders a sheet modal (slides from the side).
templ [[.ModalName]](props [[.ModalName]]Props) {
	<div
		class="fixed inset-0 z-50 flex justify-end bg-black/50"
		_="on click if event.target === me remove me"
	>
		<div
			class="bg-white dark:bg-gray-900 w-full max-w-md h-full overflow-y-auto shadow-xl animate-slide-in-right"
		>
			<!-- Header -->
			<div class="sticky top-0 flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900">
				<div>
					<h2 class="text-lg font-semibold text-gray-900 dark:text-white">
						{ props.Title }
					</h2>
					if props.Description != "" {
						<p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
							{ props.Description }
						</p>
					}
				</div>
				<button
					type="button"
					class="text-gray-400 hover:text-gray-500 focus:outline-none"
					_="on click remove closest .fixed"
				>
					@Icon("x", "h-5 w-5")
				</button>
			</div>
			<!-- Content -->
			<div class="p-4">
				{ children... }
			</div>
		</div>
	</div>
}
[[- end]]

[[- if .IsConfirm]]
// [[.ModalName]] renders a confirm dialog modal.
templ [[.ModalName]](props [[.ModalName]]Props) {
	@ModalBackdrop() {
		@ModalDialog("md") {
			<!-- Content -->
			<div class="p-6">
				<div class="flex items-start gap-4">
					<div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/50 flex items-center justify-center">
						@Icon("alert-triangle", "h-6 w-6 text-red-600")
					</div>
					<div>
						<h3 class="text-lg font-medium text-gray-900 dark:text-white">
							{ props.Title }
						</h3>
						if props.Description != "" {
							<p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
								{ props.Description }
							</p>
						}
					</div>
				</div>
			</div>
			<!-- Footer -->
			<div class="flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700">
				@Button(ButtonProps{
					Variant: "outline",
					Attributes: templ.Attributes{
						"_": "on click remove closest .fixed",
					},
				}) {
					if props.CancelText != "" {
						{ props.CancelText }
					} else {
						Cancel
					}
				}
				@Button(ButtonProps{
					Variant: "destructive",
					Attributes: templ.Attributes{
						"hx-delete": props.OnConfirm,
						"hx-target": "#main-content",
						"hx-swap":   "innerHTML",
					},
				}) {
					if props.ConfirmText != "" {
						{ props.ConfirmText }
					} else {
						Confirm
					}
				}
			</div>
		}
	}
}
[[- end]]

// ModalLoading renders a loading state for modal content.
templ ModalLoading() {
	@ModalBackdrop() {
		@ModalDialog("sm") {
			<div class="p-8">
				<div class="flex items-center gap-3">
					<div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
					<span class="text-gray-600 dark:text-gray-400">Loading...</span>
				</div>
			</div>
		}
	}
}

// CloseModal closes the current modal.
templ CloseModal() {
	<script>
		document.querySelector('#modal-container').innerHTML = '';
	</script>
}
