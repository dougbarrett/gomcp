package main

import (
	"log"
	"net/http"

	"[[.ModulePath]]/internal/config"
	"[[.ModulePath]]/internal/database"
	"[[.ModulePath]]/internal/models"
	"[[.ModulePath]]/internal/web"
	// MCP:IMPORTS:START
	// MCP:IMPORTS:END
)

func main() {
	// Load configuration
	cfg := config.Load()

	// Initialize database
	db := database.Connect(cfg)

	// Auto-migrate database models
	if err := db.AutoMigrate(
		// MCP:MODELS:START
[[- if .WithAuth]]
		&models.User{},
[[- end]]
		// MCP:MODELS:END
	); err != nil {
		log.Fatalf("Failed to migrate database: %v", err)
	}

	// Wire dependencies: Repos -> Services -> Controllers
	// MCP:REPOS:START
	// MCP:REPOS:END

	// MCP:SERVICES:START
	// MCP:SERVICES:END

	// MCP:CONTROLLERS:START
	// MCP:CONTROLLERS:END

	// Setup router
	router := web.NewRouter(cfg)

	// Register routes
	// MCP:ROUTES:START
	// MCP:ROUTES:END

	log.Printf("Server starting on %s", cfg.Server.Address)
	log.Fatal(http.ListenAndServe(cfg.Server.Address, router))
}
