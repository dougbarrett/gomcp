package views

import (
	"fmt"

	"[[.ModulePath]]/internal/web/components"
)

// PasswordProps contains props for the password change form.
type PasswordProps struct {
	UserID    uint
	UserName  string
	Errors    map[string]string
	CSRFToken string
}

// PasswordPage renders the full password change page.
templ PasswordPage(props PasswordProps) {
	<div class="max-w-2xl mx-auto space-y-6">
		@components.PageHeader("Change Password", fmt.Sprintf("Update password for %s", props.UserName))
		@PasswordForm(props)
		<div class="mt-6">
			<a href="/admin/users" class="text-sm text-gray-600 hover:underline">
				&larr; Back to users
			</a>
		</div>
	</div>
}

// PasswordForm renders the password change form.
templ PasswordForm(props PasswordProps) {
	@components.Card(components.CardProps{}) {
		@components.CardHeader("") {
			<h3 class="text-lg font-semibold">New Password</h3>
			<p class="text-sm text-gray-500 mt-1">
				Enter a new password for this user
			</p>
		}
		@components.CardContent("") {
			if props.Errors["_form"] != "" {
				@components.ErrorAlert(props.Errors["_form"])
			}
			<form
				method="POST"
				action={ templ.SafeURL(fmt.Sprintf("/admin/users/%d/password", props.UserID)) }
				class="space-y-4"
			>
				<input type="hidden" name="csrf_token" value={ props.CSRFToken }/>

				<div class="space-y-2">
					@components.Label("password", true) {
						New Password
					}
					@components.Input(components.InputProps{
						ID:          "password",
						Name:        "password",
						Type:        "password",
						Placeholder: "Enter new password (min. 8 characters)",
						Required:    true,
						Error:       props.Errors["password"],
					})
					@components.FormError(props.Errors["password"])
				</div>

				<div class="space-y-2">
					@components.Label("confirm_password", true) {
						Confirm Password
					}
					@components.Input(components.InputProps{
						ID:          "confirm_password",
						Name:        "confirm_password",
						Type:        "password",
						Placeholder: "Confirm new password",
						Required:    true,
						Error:       props.Errors["confirm_password"],
					})
					@components.FormError(props.Errors["confirm_password"])
				</div>

				<div class="pt-4 flex gap-2">
					@components.Button(components.ButtonProps{Type: "submit"}) {
						Update Password
					}
					<a
						href="/admin/users"
						class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
					>
						Cancel
					</a>
				</div>
			</form>
		}
	}
}
